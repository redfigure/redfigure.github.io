# 全文検索エンジン運用とシェル芸

---

## 自己紹介

はじめまして

* シェル芸勉強開発参加
* 普段はPythonとたまにRuby
* 全文検索エンジンの運用担当
* Twitter:[@redfigure](https://twitter.com/redfigure)

___

# 今日のお話

___

## 運用にシェル芸使ってみた

Groongaって知ってる方いますか？


---

## git diff からパッチ作るマン

課題

1. 追加するDDLはファイルへ直接追記して管理
2. 差分をとってパッチファイルを作る
3. 人の手による温かみがありすぎる

___

## こう書いた

% git diff XXXXXX ZZZZZZ | awk 'NF > 0 { if($1 ~ /^\+\+.*/){next} else if($1 ~ /^\+/) print $0 }' | sed 's/^\+//' > patch.ddl

___

## 改善案

- いちいちコピペするのめんどくさい
- git log から出力できたほうがいいね

___

ログに関わるネタこれだけッス

(´・ω・｀)
___

## スキーマチェックマン

課題

1. 追加したカラムが多いと確認が辛い
2. 漏れに気づかないとデータ投入で事故る
3. 人の手による温かみが（ｒｙ

___

## こう書いた

awk 'NF > 0 { if($1 !~ /^table\_create/) system("groonga [DB\_PATH] select " $2 " --output\_columns " $3 " --limit 0") }' [PATCH_PATH]
___

## 改善案

- 省略された記法にも対応したい
- 巨大なスキーマだと遅すぎる

---

# ワンライナー素敵！

___

# 有難うございました！
