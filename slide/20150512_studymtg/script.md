# シェル芸人によるログ集計

---

## 近況とか

* シェル芸勉強会初参加
* アカデミックな勉強会初参加
* 怖い人は少数なので皆勉強会行くべき

---

# 今日のお話

___

## そのログ集計大げさじゃない？

またES+Kibanaですか？

___

* Apacheログ
    * 接続元を集計
    * GETのパラメータを集計
* アプリケーションログ
    * 特定の例外ログを抽出
    * 再現性のあるエラーだけ抽出

などなど

---

# シェル芸とは

「マウスも使わず、ソースコードも残さず、GUIツールを立ち上げる間もなく、あらゆる調査・計算・テキスト処理を CLI端末へのコマンド入力一撃で終わらせること」とUSP友の会で定義されている。

___

## デメリット

1. historyでしか何をやったかわからない
2. 正規表現が絡むととたんに難解
3. 画像生成とかが面倒（PHPとかにやらせよう）
4. 熟練者ですら熟練者のやったことが理解不能

___

## メリット

1. 対話環境＝シェル
2. なぜか40代以降の世代に好まれる
3. 単純故に応用の幅が広い

---

# 実例

___

Q1.

Apacheのログからアクセス元ごとにステータスを集計

※第16回シェル芸勉強会応用

___

A1.

変なアクセスをしている犯人探しになど

zcat access_log.nasa.gz | awk '{print $1,$(NF-1)}' | sort | uniq -c | sort -k1,1n -k3,3n

___

Q2.

Groongaのログから同じクエリの件数を知りたい

キャッシュの調整などに

___

A2.

cat query.log | grep ">/d/select.json?" | awk -F ">" '{print $2}' | sort | uniq -c | sort

---

## 結論

- 既存の技術でできないかまず探る
- 単発でやることはわざわざツールに任せない
- 継続して調査する価値のあるものをツールへ受け入れる
